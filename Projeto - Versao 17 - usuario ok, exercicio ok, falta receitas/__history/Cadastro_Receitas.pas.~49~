unit Cadastro_Receitas;

interface

uses
  Winapi.Windows, Winapi.Messages, System.SysUtils, System.Variants, System.Classes, Vcl.Graphics,
  Vcl.Controls, Vcl.Forms, Vcl.Dialogs, Vcl.ExtCtrls, Vcl.Buttons, Vcl.StdCtrls,
  Data.DB, Vcl.Grids, Vcl.DBGrids, Vcl.DBCtrls,
  FireDAC.Stan.Intf, FireDAC.Stan.Option, FireDAC.Stan.Param,
  FireDAC.Stan.Error, FireDAC.DatS, FireDAC.Phys.Intf, FireDAC.DApt.Intf,
  FireDAC.Stan.Async, FireDAC.DApt, FireDAC.Comp.DataSet, FireDAC.Comp.Client,
  Data.Win.ADODB, Vcl.Mask;

type
  TCadastro_Receita = class(TForm)
    NomePessoa: TLabel;
    Cardapio: TLabel;
    lista_alimento: TDBGrid;
    Salvar: TButton;
    Excluir: TButton;
    Proximo: TButton;
    Anterior: TButton;
    Refeicao: TLabel;
    DiadaSemana: TLabel;
    btn1: TSpeedButton;
    DataSource1: TDataSource;
    FDQuery1: TFDQuery;
    Nome: TDBEdit;
    DBEdit1: TDBEdit;
    DBEdit2: TDBEdit;
    DBEdit3: TDBEdit;
    procedure btn1Click(Sender: TObject);
  private
    procedure GridDblClick(Sender: TObject); // 👈 adiciona aqui
  public
  end;


var
  Cadastro_Receita: TCadastro_Receita;

implementation

{$R *.dfm}

uses Conexao;

procedure TCadastro_Receita.btn1Click(Sender: TObject);
var
  FormGrid: TForm;
  Grid: TDBGrid;
  DSGrid: TDataSource;
  QryGrid: TFDQuery;
begin
  // Cria o form modal temporário
  FormGrid := TForm.Create(Self);
  try
    FormGrid.Caption := 'Usuários Cadastrados';
    FormGrid.Width := 500;
    FormGrid.Height := 300;
    FormGrid.Position := poScreenCenter;
    FormGrid.BorderStyle := bsDialog;
    FormGrid.Color := clBtnFace;

    // Cria a query do grid
    QryGrid := TFDQuery.Create(FormGrid);
    QryGrid.Connection := DataModule1.FDConnection1;
    QryGrid.SQL.Text :=
      'SELECT ' +
      '  CAST(NOME AS VARCHAR(100)) AS NOME, ' +
      '  CAST(CPF AS VARCHAR(20)) AS CPF ' +
      'FROM USUARIOS ' +
      'ORDER BY NOME;';
    QryGrid.Open;

    // Cria o DataSource do grid
    DSGrid := TDataSource.Create(FormGrid);
    DSGrid.DataSet := QryGrid;

    // Cria o DBGrid
    Grid := TDBGrid.Create(FormGrid);
    Grid.Parent := FormGrid;
    Grid.Align := alClient;
    Grid.DataSource := DSGrid;
    Grid.ReadOnly := True;
    Grid.Options := [dgTitles, dgRowSelect, dgColLines, dgRowLines];
    Grid.TitleFont.Style := [fsBold];
    Grid.Font.Size := 10;
    Grid.BorderStyle := bsSingle;

    // Ajusta colunas
    Grid.Columns[0].Title.Caption := 'Nome';
    Grid.Columns[1].Title.Caption := 'CPF';
    Grid.Columns[0].Width := 300;
    Grid.Columns[1].Width := 150;
    Grid.Columns[1].Alignment := taCenter;
    Grid.Columns[0].Alignment := taLeftJustify;

    // Guarda a query dentro do Tag para o evento
    Grid.Tag := NativeInt(QryGrid);

    // Vincula o evento de duplo clique
    Grid.OnDblClick := GridDblClick;

    // Exibe o form modal
    FormGrid.ShowModal;

  finally
    FormGrid.Free;
  end;
end;

// Evento do duplo clique no grid
procedure TCadastro_Receita.GridDblClick(Sender: TObject);
var
  Grid: TDBGrid;
  QryGrid: TFDQuery;
  NomeSelecionado: string;
begin
  Grid := TDBGrid(Sender);
  if not Assigned(Grid) then Exit;

  // Recupera a query associada
  QryGrid := TFDQuery(Pointer(Grid.Tag));
  if not Assigned(QryGrid) then Exit;

  // Pega o nome selecionado
  NomeSelecionado := QryGrid.FieldByName('NOME').AsString;

  // Fecha o modal
  if Assigned(Grid.Owner) and (Grid.Owner is TForm) then
    (Grid.Owner as TForm).ModalResult := mrOk;

  // Atribui o nome ao campo TDBEdit
  Nome.Text := NomeSelecionado;
end;

end.

